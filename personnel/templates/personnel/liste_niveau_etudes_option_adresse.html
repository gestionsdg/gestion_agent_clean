{% extends "base.html" %}
{% load static %}
{% load extra_filters %}

{% block content %}
<div style="max-width: 1100px; margin: 30px auto;">

  <!-- Titre centré et souligné -->
  <h2 style="text-align: center; margin-bottom: 10px; text-decoration: underline;">
    {{ titre }}
  </h2>
  <hr>

  <!-- Zone filtres + boutons PDF -->
  <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap:8px;">

    <!-- Formulaire de choix d'entité (affichage HTML) -->
    <form method="get" style="margin:0; display:flex; align-items:center; gap:6px;">
      <label for="id_entite" style="margin:0; font-size:13px; font-weight:bold;">Entité :</label>
      <select name="entite" id="id_entite" style="font-size:13px; padding:2px 4px;">
        <option value="">-- Toutes les entités --</option>
        {% for e in entites %}
          <option value="{{ e }}" {% if entite_choisie == e %}selected{% endif %}>
            {{ e }}
          </option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-secondary btn-sm">Afficher</button>
    </form>

    <!-- Boutons PDF -->
    <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">

      <!-- PDF classique (avec éventuelle entité choisie) -->
      <a href="{% url 'personnel:liste_niveau_etudes_option_adresse_pdf' %}{% if entite_choisie %}?entite={{ entite_choisie|urlencode }}{% endif %}"
         class="btn btn-primary" target="_blank">
        Imprimer en PDF (filtré par entité)
      </a>

      <!-- PDF TOUTES ENTITÉS PAR OPTION (NOUVELLE VUE PDF) -->
      <form method="get"
            action="{% url 'personnel:liste_niveau_etudes_option_adresse_par_option_pdf' %}"
            style="margin:0; display:flex; align-items:center; gap:6px;">
        <label for="id_option" style="margin:0; font-size:13px; font-weight:bold;">Option :</label>
        <input type="text"
               name="option"
               id="id_option"
               value="{{ request.GET.option }}"
               placeholder="Ex : Informatique"
               style="font-size:13px; padding:2px 4px; min-width:160px;">
        <button type="submit" class="btn btn-outline-primary btn-sm">
          Imprimer toutes les entités (par option)
        </button>
      </form>

    </div>
  </div>

  <table class="table table-bordered table-sm"
         style="width: 100%; border-collapse: collapse; font-size: 13px;">
    <thead>
      <tr style="background-color: #f0f0f0;">
        <th style="text-align:center;">N°</th>
        <th style="text-align:center; white-space: nowrap;">Nom</th>
        <th style="text-align:center;">Matricule</th>
        <th style="text-align:center;">Sexe</th>

        <!-- Grade : Titre centré + empêcher retour à la ligne -->
        <th style="text-align:center; white-space: nowrap;">Grade actuel</th>

        <th style="text-align:center;">Niveau études</th>
        <th style="text-align:center;">Option</th>
        <th style="text-align:center;">Adresse</th>
      </tr>
    </thead>

    <tbody>
      {% for emp in employes %}
      <tr>
        <td style="text-align: center;">{{ forloop.counter }}</td>

        <!-- Nom : sur une seule ligne -->
        <td style="text-align: left; white-space: nowrap;">
          {{ emp.nom|clean_nan }}
        </td>

        <td style="text-align: center;">{{ emp.matricule|clean_nan }}</td>
        <td style="text-align: center;">{{ emp.sexe|clean_nan }}</td>

        <!-- Grade : empêcher retour à la ligne -->
        <td style="text-align: left; white-space: nowrap;">
          {{ emp.grade_actuel|clean_nan }}
        </td>

        <td style="text-align: left;">{{ emp.niveau_etudes|clean_nan }}</td>
        <td style="text-align: left;">{{ emp.option|clean_nan }}</td>
        <td style="text-align: left;">{{ emp.adresse|clean_nan }}</td>
      </tr>

      {% empty %}
      <tr>
        <td colspan="8" style="text-align: center;">Aucun agent trouvé pour cette entité.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
