{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Effectif des Agents par Entité</title>
  <style>
    @page { size: A4 portrait; margin: 1cm; }

    thead { display: table-header-group; }
    tfoot { display: table-row-group; }

    /* ===== En-tête ===== */
    .logo-top { margin-bottom: 8px; text-align: left; }
    .logo-top img { height: 80px; display: block; }
    h2 { text-align:center; text-decoration: none; margin: 0; font-size: 20px; }
    .trait-bleu { border: none; height: 1.5px; background-color: #1F497D; margin: 10px 0 18px 0; }

    table { width: 65%; border-collapse: collapse; margin: 12px auto 20px auto; font-size: 13px; }
    th, td { border: 1px solid #000; padding: 6px; text-align: center; }
    th { background-color: #f2f2f2; }
    td.entite { text-align: left; }

    tfoot tr { break-inside: avoid; }
    .total-row td { font-weight: bold; background-color: #e0e0e0; }

    .btn { display: inline-block; margin: 20px auto; padding: 8px 12px; background-color: #007bff; color: #fff; text-decoration: none; border-radius: 5px; }
    .btn-retour { margin-left: 10px; }

    .footer-impression { display: none; }

    @media print {
      .btn { display: none; }
      body { padding-bottom: 60px !important; }
      .footer-impression { display: block; }
    }
  </style>
</head>
<body>

  <!-- ✅ Logo -->
  <div class="logo-top">
    {% if logo_b64 %}
      <img src="{{ logo_b64 }}" alt="Logo CNSS">
    {% else %}
      <img src="{% static 'images/logo_cnss.png' %}" alt="Logo CNSS">
    {% endif %}
  </div>

  <!-- ✅ Titre -->
  <h2>Effectif des Agents par Entité</h2>
  <hr class="trait-bleu">

  <table>
    <thead>
      <tr>
        <th>N°</th>
        <th>Entité</th>
        <th>Effectif agents</th>
      </tr>
    </thead>
    <tbody>
      {% for ligne in donnees %}
        <tr>
          <td>{{ ligne.numero }}</td>
          <td class="entite">{{ ligne.entite }}</td>
          <td>{{ ligne.effectif }}</td>
        </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr class="total-row">
        <td colspan="2">Total général</td>
        <td>{{ total_general }}</td>
      </tr>
    </tfoot>
  </table>

  <div style="text-align:center;">
    <a href="{% url 'personnel:liste_effectif_par_entite_pdf' %}" target="_blank" class="btn">Imprimer en PDF</a>
    <a href="{% url 'personnel:liste_employes' %}" class="btn btn-retour">Retour à la liste</a>
  </div>

  <!-- ✅ Footer impression -->
  {% include "personnel/_footer_impression.html" %}
</body>
</html>
