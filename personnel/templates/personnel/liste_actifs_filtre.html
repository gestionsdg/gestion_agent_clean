<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>{{ titre }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Marges page */
    body { font-family: Arial, sans-serif; margin: 10px 28px; font-size: 13px; }
    h2 { text-align: center; text-decoration: underline; margin-bottom: 12px; }

    /* ‚úÖ Contrainte portrait √† l'√©cran (A4 ~ 210mm de large) */
    .sheet-portrait {
      width: 210mm;          /* largeur A4 portrait */
      max-width: 100%;       /* ne d√©passe pas l'√©cran */
      margin: 0 auto;        /* centre le bloc */
    }

    form.filters { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-bottom: 10px; }
    select, button, a.btn { padding: 6px 10px; font-size: 13px; }

    /* Anti-d√©bordement horizontal du tableau sur petits √©crans */
    .table-wrap { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }

    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 6px; word-wrap: break-word; }
    th { background: #f3f4f6; text-align: center; }
    td.center { text-align: center; }
    td.left { text-align: left; }

    .actions { display: flex; gap: 8px; justify-content: flex-end; margin: 8px 0 12px; }

    /* Boutons g√©n√©riques */
    .btn { text-decoration: none; border: 1px solid #0d6efd; padding: 6px 10px; border-radius: 4px; display: inline-block; }

    /* ‚úÖ Bouton Retour (VERT, texte blanc gras) */
    .btn-back { background: #16a34a; border-color: #16a34a; color: #fff; font-weight: 700; }
    .btn-back:hover { filter: brightness(0.95); }

    /* Bouton PDF : bleu, texte blanc gras */
    .btn-pdf { background: #0d6efd; color: #fff; font-weight: 700; }
    .btn-pdf:hover { filter: brightness(0.95); }

    /* Impression en portrait (utile aussi pour la sortie papier) */
    @page { size: A4 portrait; }
    @media print {
      @page { size: A4 portrait; margin: 12mm 18mm; } /* top/bottom 12mm, left/right 18mm */
      body { margin: 0; }
      .sheet-portrait { width: auto; } /* laisse l'imprimeur g√©rer la largeur */
    }
  </style>
</head>
<body>
  <div class="sheet-portrait">
    <h2>{{ titre }}</h2>

    <form class="filters" method="get">
      {% url 'personnel:liste_employes' as back_url %}
      <!-- ‚úÖ Bouton Retour √† la liste des employ√©s (tol√©rant + fallback) -->
      <a class="btn btn-back" href="{{ back_url|default:'/' }}">‚Ü©Ô∏è Retour √† la liste des employ√©s</a>

      <label>Entit√© :
        <select name="entite">
          {% for value,label in entites %}
            <option value="{{ value }}" {% if value == entite_sel %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </label>

      <label>Grade actuel :
        <select name="grade">
          {% for value,label in grades %}
            <option value="{{ value }}" {% if value == grade_sel %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </label>

      <button type="submit">Appliquer</button>

      {# ‚úÖ Lien PDF namespac√© qui conserve les filtres #}
      <a class="btn btn-pdf"
         href="{% url 'personnel:liste_actifs_filtre_pdf' %}{% if entite_sel or grade_sel %}?{% if entite_sel %}entite={{ entite_sel|urlencode }}{% endif %}{% if entite_sel and grade_sel %}&{% endif %}{% if grade_sel %}grade={{ grade_sel|urlencode }}{% endif %}{% endif %}"
         target="_blank">
        üñ®Ô∏è Imprimer PDF
      </a>
    </form>

    <div class="table-wrap">
      <table>
        <colgroup>
          <col style="width:40px;">
          <col style="width:35%;">   <!-- Nom (diminu√©) -->
          <col style="width:70px;">  <!-- Matricule (diminu√©) -->
          <col style="width:32%;">   <!-- Fonction (diminu√©) -->
        </colgroup>
        <thead>
          <tr>
            <th>N¬∞</th>
            <th>Nom</th>
            <th>Matricule</th>
            <th>Fonction</th>
          </tr>
        </thead>
        <tbody>
          {% for a in agents %}
            <tr>
              <td class="center">{{ forloop.counter }}</td>
              <td class="left">{{ a.nom }}</td>
              <td class="center">{{ a.matricule }}</td>
              <td class="left">{{ a.fonction|default:"-" }}</td>
            </tr>
          {% empty %}
            <tr><td class="center" colspan="4">Aucun agent trouv√©.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
